<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmulatorJS æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .game-container {
            width: 100%;
            height: 400px;
            border: 2px solid #333;
            border-radius: 5px;
            margin: 20px 0;
            background: #000;
        }
        .controls {
            margin: 20px 0;
        }
        input[type="file"] {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        select {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 100%;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® EmulatorJS åŸç”Ÿæµ‹è¯•</h1>
        
        <div class="controls">
            <h3>é€‰æ‹©æ¸¸æˆæ–‡ä»¶:</h3>
            <input type="file" id="romFile" accept=".nes,.NES,.smc,.SMC,.gb,.GB,.gba,.GBA" />
            
            <h3>é€‰æ‹©æ¨¡æ‹Ÿå™¨æ ¸å¿ƒ:</h3>
            <select id="coreSelect">
                <option value="nes">NES (ä»»å¤©å ‚çº¢ç™½æœº)</option>
                <option value="snes">SNES (è¶…çº§ä»»å¤©å ‚)</option>
                <option value="gb">Game Boy</option>
                <option value="gba">Game Boy Advance</option>
                <option value="n64">Nintendo 64</option>
                <option value="psx">PlayStation</option>
                <option value="segaMS">Sega Genesis</option>
            </select>
            
            <button onclick="loadGame()">åŠ è½½æ¸¸æˆ</button>
            <button onclick="resetGame()">é‡ç½®</button>
        </div>
        
        <div id="status" class="status"></div>
        
        <div class="game-container">
            <div id="game"></div>
        </div>
        
        <div>
            <h3>ä½¿ç”¨è¯´æ˜:</h3>
            <ul>
                <li>é€‰æ‹©ROMæ–‡ä»¶ï¼ˆæ”¯æŒ.nes, .smc, .gb, .gbaç­‰æ ¼å¼ï¼‰</li>
                <li>é€‰æ‹©å¯¹åº”çš„æ¨¡æ‹Ÿå™¨æ ¸å¿ƒ</li>
                <li>ç‚¹å‡»"åŠ è½½æ¸¸æˆ"æŒ‰é’®</li>
                <li>ä½¿ç”¨é”®ç›˜æ§åˆ¶æ¸¸æˆï¼ˆæ–¹å‘é”® + A/S/Z/Xï¼‰</li>
                <li>åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¼šè‡ªåŠ¨æ˜¾ç¤ºè™šæ‹Ÿæ¸¸æˆæ‰‹æŸ„</li>
            </ul>
        </div>
    </div>

    <script>
        let currentRom = null;
        let isGameLoaded = false;

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        function loadGame() {
            const fileInput = document.getElementById('romFile');
            const coreSelect = document.getElementById('coreSelect');
            
            if (!fileInput.files[0]) {
                showStatus('è¯·å…ˆé€‰æ‹©ROMæ–‡ä»¶', 'error');
                return;
            }

            const file = fileInput.files[0];
            const core = coreSelect.value;
            
            // æ¸…é™¤ä¹‹å‰çš„æ¸¸æˆ
            if (isGameLoaded) {
                const gameDiv = document.getElementById('game');
                gameDiv.innerHTML = '';
                isGameLoaded = false;
            }

            // åˆ›å»ºæ–°çš„æ¸¸æˆå®¹å™¨
            const gameDiv = document.getElementById('game');
            gameDiv.innerHTML = '<div id="emulator-game"></div>';

            // åˆ›å»ºROM URL
            currentRom = URL.createObjectURL(file);
            
            showStatus(`æ­£åœ¨åŠ è½½ ${file.name}...`);

            // è®¾ç½®EmulatorJSé…ç½®
            window.EJS_player = '#emulator-game';
            window.EJS_core = core;
            window.EJS_gameUrl = currentRom;
            window.EJS_pathtodata = 'https://cdn.emulatorjs.org/stable/data';
            window.EJS_startOnLoaded = true;
            window.EJS_gameName = file.name.replace(/\.[^/.]+$/, "");

            // äº‹ä»¶å›è°ƒ
            window.EJS_ready = () => {
                console.log("æ¨¡æ‹Ÿå™¨å‡†å¤‡å°±ç»ª");
                isGameLoaded = true;
                showStatus(`æ¸¸æˆ ${file.name} åŠ è½½æˆåŠŸï¼`);
            };

            window.EJS_onGameStart = () => {
                console.log("æ¸¸æˆå·²å¼€å§‹");
                showStatus("æ¸¸æˆå·²å¼€å§‹è¿è¡Œ");
            };

            window.EJS_onSaveState = () => {
                console.log("çŠ¶æ€å·²ä¿å­˜");
                showStatus("æ¸¸æˆçŠ¶æ€å·²ä¿å­˜");
            };

            window.EJS_onLoadState = () => {
                console.log("çŠ¶æ€å·²åŠ è½½");
                showStatus("æ¸¸æˆçŠ¶æ€å·²åŠ è½½");
            };

            // åŠ¨æ€åŠ è½½EmulatorJSè„šæœ¬
            const script = document.createElement('script');
            script.src = 'https://cdn.emulatorjs.org/stable/data/loader.js';
            script.onload = () => {
                console.log("EmulatorJSè„šæœ¬åŠ è½½å®Œæˆ");
            };
            script.onerror = () => {
                console.error("EmulatorJSè„šæœ¬åŠ è½½å¤±è´¥");
                showStatus("EmulatorJSè„šæœ¬åŠ è½½å¤±è´¥", 'error');
            };
            document.head.appendChild(script);
        }

        function resetGame() {
            const gameDiv = document.getElementById('game');
            gameDiv.innerHTML = '';
            isGameLoaded = false;
            
            if (currentRom) {
                URL.revokeObjectURL(currentRom);
                currentRom = null;
            }
            
            showStatus('æ¸¸æˆå·²é‡ç½®');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('è¯·é€‰æ‹©ROMæ–‡ä»¶å¹¶ç‚¹å‡»"åŠ è½½æ¸¸æˆ"æŒ‰é’®');
        });
    </script>
</body>
</html>
